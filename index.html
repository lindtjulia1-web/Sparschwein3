<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>KGB Piggy Bank Pro Editor - Full Custom</title>
    <style>
        :root { --accent: #f9e076; --bg: #1e1e24; --panel: #2a2a32; --border: #3d3d45; --green: #4caf50; --red: #f44336; }
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: #fff; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 400px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 20px; }
        h2 { color: var(--accent); font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; margin: 20px 0 10px; border-left: 3px solid var(--accent); padding-left: 10px; }
        h3 { font-size: 13px; color: var(--accent); margin: 20px 0 10px; display: flex; align-items: center; justify-content: space-between; }
        .card { background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 12px; border-radius: 15px; margin-bottom: 20px; }
        label { display: block; font-size: 10px; color: #aaa; text-transform: uppercase; margin-top: 8px; }
        input, select, textarea { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 8px; margin-top: 4px; box-sizing: border-box; outline: none; font-size: 13px; }
        .btn { border: none; padding: 14px; width: 100%; border-radius: 12px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        .btn-main { background: #ffb347; color: #000; } 
        .btn-code { background: #77dd77; color: #000; } 
        .preview { flex: 1; background: #0c0c0e; display: flex; align-items: center; justify-content: center; padding: 40px; }
        #device-wrapper { position: relative; transition: 0.3s; background: transparent; border-radius: 30px; }
        iframe { width: 100%; height: 100%; border: none; display: block; border-radius: 30px; background: transparent; }
        .color-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        #code-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; z-index: 100; flex-direction: column; }
        #result-code { width: 80%; height: 50%; background: #111; color: var(--accent); padding: 20px; border: 1px solid var(--accent); border-radius: 20px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-content">
        <h2>1. Настройки Экрана</h2>
        <div class="color-grid">
            <div><label>Ширина</label><input type="number" id="width" value="800"></div>
            <div><label>Высота</label><input type="number" id="height" value="450"></div>
        </div>
        <label>Фон (URL)</label><input type="text" id="bg-url" placeholder="URL картинки">
        <label>Громкость эффектов</label>
        <input type="range" id="volume" min="0" max="1" step="0.1" value="0.5">

        <h2>2. Язык и Шрифты</h2>
        <select id="lang-select" onchange="applyLang()">
            <option value="ru">Русский</option>
            <option value="de">Deutsch</option>
            <option value="en">English</option>
            <option value="fr">Français</option>
        </select>
        <label>Шрифт</label>
        <select id="font-family">
            <option value="Segoe UI">Segoe UI</option>
            <option value="Indie Flower">Indie Flower</option>
            <option value="Jolly Lodger">Jolly Lodger</option>
            <option value="Metrophobic">Metrophobic</option>
            <option value="ABeeZee">ABeeZee</option>
            <option value="Abril Fatface">Abril Fatface</option>
            <option value="Aclonica">Aclonica</option>
        </select>

        <h2>3. Тексты</h2>
        <label>Заголовок</label><input type="text" id="start-title" value="Сокровища Пирата">
        <label>Кнопка Старт</label><input type="text" id="start-btn-text" value="В БОЙ">
        <label>Ставка (Stake)</label><input type="text" id="stake-text" value="ВЫБЕРИ СТАВКУ:">
        <label>Фитбек (Победа)</label><input type="text" id="win-text" value="ЗОЛОТО ВАШЕ!">
        <label>Кнопка Финала</label><input type="text" id="final-btn-text" value="ЗАНОВО">

        <h2>4. Цвета и Дизайн</h2>
        <div class="color-grid">
            <div><label>Текст</label><input type="color" id="text-color" value="#f9e076"></div>
            <div><label>Рамка</label><input type="color" id="neon-color" value="#f9e076"></div>
        </div>
        <div class="color-grid">
            <div><label>Кнопки</label><input type="color" id="btn-color" value="#f9e076"></div>
            <div><label>Фон Вопроса</label><input type="color" id="q-bg-color" value="#333333"></div>
        </div>

        <h2>5. Параметры кнопок</h2>
        <label>Размер шрифта (%)</label><input type="range" id="fontSize" min="2" max="8" step="0.1" value="3.5">
        <div class="color-grid">
            <div><label>Высота кн.</label><input type="number" id="btn-height" value="9"></div>
            <div><label>Gap (отступ)</label><input type="number" id="btn-gap" value="2"></div>
        </div>
        <label>Отступ от краев (vmin)</label><input type="number" id="btn-padding" value="8">

        <h2>Уровни</h2>
        <div id="levels-container"></div>
    </div>
    <div style="padding: 20px; border-top: 1px solid var(--border);">
        <button class="btn btn-main" onclick="updatePreview()">ОБНОВИТЬ ПРЕВЬЮ</button>
        <button class="btn btn-code" onclick="getGeniallyCode()">ПОЛУЧИТЬ КОД</button>
    </div>
</div>

<div class="preview">
    <div id="device-wrapper"><iframe id="ifr" allowtransparency="true"></iframe></div>
</div>

<div id="code-modal">
    <textarea id="result-code" readonly></textarea>
    <button class="btn" onclick="document.getElementById('code-modal').style.display='none'" style="width: 200px; background:#fff;">ЗАКРЫТЬ</button>
</div>

<script>
const GITHUB_RAW = "https://raw.githubusercontent.com/lindtjulia1-web/Sparschwein1/main/";

const langData = {
    ru: { title: "Сокровища Пирата", start: "В БОЙ", stake: "ВЫБЕРИ СТАВКУ:", win: "ЗОЛОТО ВАШЕ!", final: "ЗАНОВО" },
    de: { title: "Piratenschatz", start: "START", stake: "EINSATZ WÄHLEN:", win: "DU HAST GEWONNEN!", final: "NEUSTART" },
    en: { title: "Pirate Treasure", start: "FIGHT", stake: "CHOOSE STAKE:", win: "VICTORY IS YOURS!", final: "RESTART" },
    fr: { title: "Trésor Pirate", start: "JOUER", stake: "CHOИСИR MISE:", win: "L'OR EST À VOUS!", final: "RECOMMENCER" }
};

function applyLang() {
    const d = langData[document.getElementById('lang-select').value];
    document.getElementById('start-title').value = d.title;
    document.getElementById('start-btn-text').value = d.start;
    document.getElementById('stake-text').value = d.stake;
    document.getElementById('win-text').value = d.win;
    document.getElementById('final-btn-text').value = d.final;
}

for(let i=1; i<=4; i++) {
    const lvlDiv = document.createElement('div');
    lvlDiv.className = 'card';
    lvlDiv.innerHTML = `<h3>УРОВЕНЬ ${i}</h3><textarea id="lvl-${i}-q" placeholder="Вопросы"></textarea><textarea id="lvl-${i}-c" placeholder="Верные"></textarea><textarea id="lvl-${i}-w" placeholder="Неверные (через запятую)"></textarea>`;
    document.getElementById('levels-container').appendChild(lvlDiv);
}

function buildInnerGame() {
    const levels = [];
    for(let i=1; i<=4; i++) {
        const qLines = document.getElementById(`lvl-${i}-q`).value.split('\n').filter(l => l.trim());
        const cLines = document.getElementById(`lvl-${i}-c`).value.split('\n').filter(l => l.trim());
        const wLines = document.getElementById(`lvl-${i}-w`).value.split('\n').filter(l => l.trim());
        levels.push(qLines.map((q, idx) => ({ q: q.trim(), a: [(cLines[idx] || "???").trim(), ...(wLines[idx] || "").split(',').map(x => x.trim()).filter(x => x)] })));
    }

    const cfg = {
        bg: document.getElementById('bg-url').value,
        font: document.getElementById('font-family').value,
        title: document.getElementById('start-title').value,
        btnTxt: document.getElementById('start-btn-text').value,
        stakeTxt: document.getElementById('stake-text').value,
        winTxt: document.getElementById('win-text').value,
        finalTxt: document.getElementById('final-btn-text').value,
        txtCol: document.getElementById('text-color').value,
        neon: document.getElementById('neon-color').value,
        btnCol: document.getElementById('btn-color').value,
        qBg: document.getElementById('q-bg-color').value,
        fz: document.getElementById('fontSize').value,
        btnH: document.getElementById('btn-height').value,
        btnGap: document.getElementById('btn-gap').value,
        btnPad: document.getElementById('btn-padding').value,
        vol: document.getElementById('volume').value,
        levels: levels,
        pigs: [GITHUB_RAW+"1.png", GITHUB_RAW+"2.png", GITHUB_RAW+"3.png", GITHUB_RAW+"4.png", GITHUB_RAW+"5.png", GITHUB_RAW+"6.png"],
        coin: GITHUB_RAW+"7.png",
        sfxCoin: GITHUB_RAW+"1.mp3",
        sfxFinal: GITHUB_RAW+"2.mp3"
    };

    return `<!DOCTYPE html><html><head><meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=${cfg.font.replace(/ /g, '+')}:wght@400;900&display=swap" rel="stylesheet">
    <style>
        body { margin:0; height:100vh; overflow:hidden; font-family: '${cfg.font}', sans-serif; background:transparent; color:${cfg.txtCol}; display:flex; flex-direction:column; border-radius:30px; border: 6px solid ${cfg.neon}; box-shadow: inset 0 0 15px ${cfg.neon}; box-sizing: border-box; transition: 0.3s; }
        body.error-flash { border-color: #f44336; box-shadow: inset 0 0 30px #f44336; }
        .bg { position:fixed; inset:0; background:url(${cfg.bg}) center/cover; opacity:0.5; z-index:-1; }
        #game { height:100%; display:flex; flex-direction:column; justify-content: space-between; padding: 5vmin ${cfg.btnPad}vmin; box-sizing:border-box; }
        .score-box { font-size:8vmin; font-weight:900; text-align:center; z-index:10; }
        #pile-box { flex:1; position:relative; display:flex; justify-content:center; align-items:center; }
        .pig-wrapper { position: relative; height: 35vmin; transition: 0.2s; }
        .pig { height: 100%; filter: drop-shadow(0 0 10px gold); z-index:5; }
        .gold-fill { position: absolute; width: 15vmin; height: 15vmin; background: radial-gradient(circle, #f9e076 0%, transparent 70%); border-radius: 50%; opacity: 0; filter: blur(10px); transition: 1s; left:50%; top:50%; transform: translate(-50%, -50%); }
        .ui { display:flex; flex-direction:column; align-items: center; z-index:10; }
        .q-text { width:100%; font-size:${cfg.fz}vmin; text-align:center; margin-bottom:${cfg.btnGap}vmin; font-weight:bold; background: ${cfg.qBg}; padding: 2vmin; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .btn-grid { display:grid; grid-template-columns: 1fr 1fr; gap: ${cfg.btnGap}vmin; width: 100%; }
        button { 
            border:none; 
            background: linear-gradient(180deg, rgba(255,255,255,0.3) 0%, rgba(0,0,0,0) 100%), ${cfg.btnCol}; 
            color:#000; height:${cfg.btnH}vmin; border-radius:15px; cursor:pointer; font-weight:900; font-size:3.2vmin; 
            font-family: inherit; transition: 0.1s; 
            box-shadow: 0 0.8vmin 0 rgba(0,0,0,0.3), 0 1vmin 2vmin rgba(0,0,0,0.5); 
        }
        button:active { transform: translateY(0.5vmin); box-shadow: 0 0.3vmin 0 rgba(0,0,0,0.3); }
        .screen { position:absolute; inset:0; background:rgba(0,0,0,0.9); z-index:100; display:flex; flex-direction:column; align-items:center; justify-content:center; border-radius:24px; }
        
        @keyframes fallImproved { 
            0% { top:-20vh; transform: translateX(-50%) rotate(0deg) scale(var(--sc)); } 
            100% { top: 40vh; transform: translateX(-50%) rotate(var(--rot)) scale(var(--sc)); opacity:0; } 
        }
        
        .falling-coin { 
            position:absolute; 
            top:-20vh; 
            left:50%; 
            width:8vmin; 
            height:8vmin; 
            background:url(${cfg.coin}) center/cover; 
            z-index:100; 
            pointer-events: none;
        }

        @keyframes pig-shake { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes pig-no { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-15px); } 75% { transform: translateX(15px); } }
        .shake-anim { animation: pig-shake 0.2s ease-out; }
        .no-anim { animation: pig-no 0.4s ease-in-out; }
    </style></head><body>
        <div class="bg"></div>
        <div id="game">
            <div id="start-screen" class="screen">
                <h1 style="font-size:8vmin; margin-bottom:4vmin; text-align:center;">${cfg.title}</h1>
                <button onclick="startGame()" style="width:40vmin; height:12vmin;">${cfg.btnTxt}</button>
            </div>
            <div class="score-box" id="total-score">0</div>
            <div id="pile-box"><div class="pig-wrapper" id="pig-wrap"><div class="gold-fill" id="gold-core"></div><img id="pig-img" src="${cfg.pigs[0]}" class="pig"></div></div>
            <div class="ui"><div class="q-text" id="q-label"></div><div id="btn-area" class="btn-grid"></div></div>
        </div>
    <script>
        let score = 0, currentLvl = 0, currentQ = 0, stake = 0;
        const cfg = ${JSON.stringify(cfg)};
        const coinSnd = new Audio(cfg.sfxCoin);
        const finalSnd = new Audio(cfg.sfxFinal);

        function startGame() { document.getElementById('start-screen').style.display='none'; nextStep(); }
        function nextStep() {
            if(currentLvl >= cfg.levels.length) { finish(); return; }
            if(currentQ >= cfg.levels[currentLvl].length) { currentLvl++; currentQ = 0; nextStep(); return; }
            showStakes();
        }
        function showStakes() {
            document.getElementById('q-label').innerText = cfg.stakeTxt;
            const area = document.getElementById('btn-area'); area.innerHTML = '';
            [10, 50, 100, 250].forEach(val => {
                const b = document.createElement('button'); b.innerText = val;
                b.onclick = () => { stake = val; showQuestion(); }; area.appendChild(b);
            });
        }
        function showQuestion() {
            const data = cfg.levels[currentLvl][currentQ];
            document.getElementById('q-label').innerText = data.q;
            const area = document.getElementById('btn-area'); area.innerHTML = '';
            [...data.a].sort(() => Math.random() - 0.5).forEach(txt => {
                const b = document.createElement('button'); b.innerText = txt;
                b.onclick = () => {
                    if(txt === data.a[0]) { 
                        score += stake; spawnCoins(Math.ceil(stake/10), false); 
                        document.getElementById('pig-img').src = cfg.pigs[Math.min(currentLvl+1, 5)]; 
                    } else { 
                        score = Math.max(0, score - stake); triggerWrong();
                    }
                    updateGold();
                    document.getElementById('total-score').innerText = score;
                    currentQ++; setTimeout(nextStep, 1000);
                }; area.appendChild(b);
            });
        }
        function triggerWrong() {
            const w = document.getElementById('pig-wrap');
            w.classList.add('no-anim'); document.body.classList.add('error-flash');
            setTimeout(() => { w.classList.remove('no-anim'); document.body.classList.remove('error-flash'); }, 400);
        }
        function spawnCoins(num, isFinal) {
            for(let i=0; i<num; i++) {
                setTimeout(() => {
                    const c = document.createElement('div'); 
                    c.className = 'falling-coin';
                    
                    const randomRot = Math.floor(Math.random() * 720) - 360;
                    const randomScale = (Math.random() * 0.4 + 0.6).toFixed(2);
                    
                    // Изменение: теперь монеты падают кучно в центре (48-52%), где находится отверстие
                    const randomLeft = isFinal ? Math.floor(Math.random() * 100) : (48 + Math.random() * 4);
                    
                    c.style.setProperty('--rot', randomRot + 'deg');
                    c.style.setProperty('--sc', randomScale);
                    c.style.left = randomLeft + '%';
                    
                    // Изменение: для обычных ответов анимация короче и направлена в свинку
                    c.style.animation = isFinal ? 'fallImproved 1.5s linear forwards' : 'fallImproved 0.6s ease-in forwards';
                    document.body.appendChild(c);
                    
                    const s = (isFinal && i === 0) ? finalSnd.cloneNode() : coinSnd.cloneNode();
                    s.volume = cfg.vol; 
                    s.play();
                    
                    const p = document.getElementById('pig-wrap');
                    p.classList.add('shake-anim');
                    setTimeout(() => { c.remove(); p.classList.remove('shake-anim'); }, isFinal ? 1500 : 600);
                }, i * (isFinal ? 50 : 100));
            }
        }
        function updateGold() {
            const core = document.getElementById('gold-core');
            const intensity = Math.min(score / 2000, 1);
            core.style.opacity = intensity;
            core.style.transform = "translate(-50%, -50%) scale(" + (1 + intensity * 2.5) + ")";
        }
        function finish() {
            document.getElementById('q-label').innerText = cfg.winTxt;
            document.getElementById('btn-area').innerHTML = '<button onclick="location.reload()" style="grid-column: 1/3">'+cfg.finalTxt+'</button>';
            spawnCoins(40, true); 
        }
    <\/script></body></html>`;
}

function updatePreview() {
    const w = document.getElementById('width').value, h = document.getElementById('height').value;
    const wrapper = document.getElementById('device-wrapper');
    wrapper.style.width = w + 'px'; wrapper.style.height = h + 'px';
    const scale = Math.min((window.innerWidth - 450) / w, (window.innerHeight - 100) / h);
    wrapper.style.transform = `scale(${scale})`;
    document.getElementById('ifr').srcdoc = buildInnerGame();
}

function getGeniallyCode() {
    const innerHtml = buildInnerGame();
    const escapedHtml = innerHtml.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&apos;');
    const w = document.getElementById('width').value, h = document.getElementById('height').value;
    document.getElementById('result-code').value = `<iframe width="${w}" height="${h}" srcdoc="${escapedHtml}" frameborder="0" scrolling="no" style="overflow:hidden; border-radius:30px; background:transparent;" allowtransparency="true"></iframe>`;
    document.getElementById('code-modal').style.display = 'flex';
}

window.onload = () => {
    document.getElementById('lvl-1-q').value = "Где золото?";
    document.getElementById('lvl-1-c').value = "На острове";
    document.getElementById('lvl-1-w').value = "В банке, В лесу";
    updatePreview();
}
</script>
</body>
</html>
