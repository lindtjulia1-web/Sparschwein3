<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>KGB Piggy Bank Pro Editor 16:9 Fixed</title>
    <style>
        :root { --accent: #f9e076; --bg: #1e1e24; --panel: #2a2a32; --border: #3d3d45; --green: #4caf50; --red: #f44336; }
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: #fff; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 400px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 20px; }
        h2 { color: var(--accent); font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; margin: 20px 0 10px; border-left: 3px solid var(--accent); padding-left: 10px; }
        .card { background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 12px; border-radius: 15px; margin-bottom: 10px; position: relative; }
        label { display: block; font-size: 10px; color: #aaa; text-transform: uppercase; margin-top: 8px; }
        input, select { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 8px; margin-top: 4px; box-sizing: border-box; font-size: 13px; }
        .btn { border: none; padding: 14px; width: 100%; border-radius: 12px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        .btn-main { background: #ffb347; color: #000; }
        .btn-code { background: #77dd77; color: #000; }
        .preview { flex: 1; background: #0c0c0e; display: flex; align-items: center; justify-content: center; padding: 20px; }
        #device-wrapper { position: relative; background: #000; border-radius: 20px; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        iframe { width: 100%; height: 100%; border: none; display: block; border-radius: 20px; }
        #code-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; z-index: 100; flex-direction: column; }
        textarea { width: 80%; height: 50%; background: #111; color: var(--accent); padding: 20px; border: 1px solid var(--accent); border-radius: 20px; }
        .color-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-content">
        <h2>Настройки Экрана 16:9</h2>
        <div class="color-grid">
            <div><label>Ширина</label><input type="number" id="width" value="1280"></div>
            <div><label>Высота</label><input type="number" id="height" value="720"></div>
        </div>
        
        <h2>Тексты и Локализация</h2>
        <div class="color-grid">
            <select id="lang">
                <option value="ru">Русский</option>
                <option value="en">English</option>
                <option value="de">Deutsch</option>
            </select>
            <input type="color" id="neon-color" value="#f9e076">
        </div>

        <h2>Размеры кнопок</h2>
        <label>Размер текста %</label><input type="range" id="fontSize" min="2" max="6" step="0.1" value="3.5">
        <div class="color-grid">
            <div><label>Высота (vmin)</label><input type="number" id="btn-height" value="9"></div>
            <div><label>Гэп (vmin)</label><input type="number" id="btn-gap" value="1.5"></div>
        </div>

        <h2>Отступы контента (vmin)</h2>
        <div class="color-grid">
            <div><label>Верх/Низ</label><input type="number" id="padV" value="4"></div>
            <div><label>Лево/Право</label><input type="number" id="padH" value="10"></div>
        </div>

        <div id="levels-container"></div>
    </div>
    <div style="padding: 20px; border-top: 1px solid var(--border);">
        <button class="btn btn-main" onclick="updatePreview()">ОБНОВИТЬ ПРЕВЬЮ</button>
        <button class="btn btn-code" onclick="getGeniallyCode()">ПОЛУЧИТЬ КОД</button>
    </div>
</div>

<div class="preview">
    <div id="device-wrapper"><iframe id="ifr"></iframe></div>
</div>

<div id="code-modal">
    <textarea id="result-code" readonly onclick="this.select()"></textarea>
    <button class="btn" onclick="document.getElementById('code-modal').style.display='none'" style="width:200px; background:#fff;">ЗАКРЫТЬ</button>
</div>

<script>
const GITHUB_RAW = "https://raw.githubusercontent.com/lindtjulia1-web/Sparschwein1/main/";

function addQ(lvl, q="", c="", w="") {
    const container = document.getElementById(`q-container-lvl-${lvl}`);
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `<label>Вопрос</label><input type="text" class="inp-q" value="${q}">
        <label style="color:var(--green)">Верный</label><input type="text" class="inp-correct" value="${c}">
        <label style="color:var(--red)">Ложные</label><input type="text" class="inp-wrong" value="${w}">`;
    container.appendChild(div);
}

for(let i=1; i<=4; i++) {
    const d = document.createElement('div');
    d.innerHTML = `<h3>Уровень ${i}</h3><div id="q-container-lvl-${i}"></div>`;
    document.getElementById('levels-container').appendChild(d);
    if(i===1) addQ(1, "Где золото?", "На острове", "В банке, В лесу");
}

function buildInnerGame() {
    const levels = [];
    for(let i=1; i<=4; i++) {
        const cards = Array.from(document.querySelectorAll(`#q-container-lvl-${i} .card`));
        levels.push(cards.map(c => ({
            q: c.querySelector('.inp-q').value,
            a: [c.querySelector('.inp-correct').value, ...c.querySelector('.inp-wrong').value.split(',').map(x => x.trim())]
        })).filter(x => x.q));
    }

    const cfg = {
        fz: document.getElementById('fontSize').value,
        neon: document.getElementById('neon-color').value,
        btnH: document.getElementById('btn-height').value,
        btnGap: document.getElementById('btn-gap').value,
        pv: document.getElementById('padV').value,
        ph: document.getElementById('padH').value,
        lang: document.getElementById('lang').value,
        levels: levels,
        pigs: [GITHUB_RAW+"1.png", GITHUB_RAW+"2.png", GITHUB_RAW+"3.png", GITHUB_RAW+"4.png", GITHUB_RAW+"5.png", GITHUB_RAW+"6.png"],
        coin: GITHUB_RAW+"7.png"
    };

    return `<!DOCTYPE html><html><head><meta charset="UTF-8">
    <style>
        body { margin:0; height:100vh; overflow:hidden; font-family:sans-serif; background:#000; color:#fff; border: 4px solid ${cfg.neon}; box-sizing: border-box; border-radius:20px; }
        #game { height:100%; display:flex; flex-direction:column; justify-content: space-between; padding:${cfg.pv}vmin ${cfg.ph}vmin; box-sizing:border-box; position:relative; z-index:2; }
        .score { font-size:7vmin; color:${cfg.neon}; font-weight:900; text-align:center; }
        #pile-box { flex:1; display:flex; justify-content:center; align-items:center; position:relative; min-height: 30vmin; }
        .pig { height:40vmin; width:auto; object-fit:contain; z-index:5; }
        .ui { display:flex; flex-direction:column; gap:1vmin; }
        .q-text { font-size:${cfg.fz}vmin; text-align:center; font-weight:bold; min-height:1.5em; }
        .btn-grid { display:grid; grid-template-columns: 1fr 1fr; gap:${cfg.btnGap}vmin; }
        button { border:none; background:${cfg.neon}; color:#000; height:${cfg.btnH}vmin; border-radius:12px; font-weight:bold; font-size:3vmin; cursor:pointer; }
        .screen { position:absolute; inset:0; background:rgba(0,0,0,0.9); z-index:100; display:flex; flex-direction:column; align-items:center; justify-content:center; }
        .coin-element { position:absolute; width:4vmin; height:4vmin; background:url(${cfg.coin}) center/cover; }
        .bg-overlay { position:fixed; inset:0; background: radial-gradient(circle at center, transparent 0%, #000 90%); z-index:1; opacity:0.6; }
    </style></head><body>
        <div class="bg-overlay"></div>
        <div id="game">
            <div id="start-screen" class="screen"><button onclick="startGame()" style="width:40vmin; height:10vmin;">В БОЙ</button></div>
            <div class="score" id="total-score">0</div>
            <div id="pile-box"><img id="pig-img" src="${cfg.pigs[0]}" class="pig"><div id="pile" style="position:absolute; inset:0;"></div></div>
            <div class="ui"><div class="q-text" id="q-label"></div><div id="btn-area" class="btn-grid"></div></div>
        </div>
    <script>
        let score=0, cL=0, cQ=0, stake=0; const cfg=${JSON.stringify(cfg)};
        function startGame(){ document.getElementById('start-screen').style.display='none'; nextStep(); }
        function nextStep(){ 
            if(cL>=cfg.levels.length) { document.getElementById('q-label').innerText="ФИНАЛ!"; return; }
            if(cQ>=cfg.levels[cL].length) { cL++; cQ=0; nextStep(); return; }
            showStakes();
        }
        function showStakes(){
            document.getElementById('q-label').innerText = "ВЫБЕРИ СТАВКУ";
            const a=document.getElementById('btn-area'); a.innerHTML='';
            [10,50,100,250].forEach(v=>{ const b=document.createElement('button'); b.innerText=v; b.onclick=()=>{stake=v;showQ();}; a.appendChild(b); });
        }
        function showQ(){
            const d=cfg.levels[cL][cQ]; document.getElementById('q-label').innerText=d.q;
            const a=document.getElementById('btn-area'); a.innerHTML='';
            [...d.a].sort(()=>Math.random()-0.5).forEach(t=>{
                const b=document.createElement('button'); b.innerText=t;
                b.onclick=()=>{
                    if(t===d.a[0]){ score+=stake; addC(); document.getElementById('pig-img').src=cfg.pigs[Math.min(cL+1,5)]; }
                    else { score=Math.max(0,score-stake); }
                    document.getElementById('total-score').innerText=score; cQ++; setTimeout(nextStep,1000);
                }; a.appendChild(b);
            });
        }
        function addC(){
            const p=document.getElementById('pile'); const c=document.createElement('div');
            c.className='coin-element'; c.style.left=(40+Math.random()*20)+'%'; c.style.top=(40+Math.random()*20)+'%';
            p.appendChild(c);
        }
    <\/script></body></html>`;
}

function updatePreview() {
    const w = document.getElementById('width').value;
    const h = document.getElementById('height').value;
    const wrp = document.getElementById('device-wrapper');
    wrp.style.width = w + 'px'; wrp.style.height = h + 'px';
    const scale = Math.min((window.innerWidth-450)/w, (window.innerHeight-100)/h);
    wrp.style.transform = `scale(${scale})`;
    document.getElementById('ifr').srcdoc = buildInnerGame();
}

function getGeniallyCode() {
    const html = buildInnerGame().replace(/"/g, '&quot;');
    const w = document.getElementById('width').value;
    const h = document.getElementById('height').value;
    document.getElementById('result-code').value = `<iframe width="${w}" height="${h}" srcdoc="${html}" frameborder="0" scrolling="no" style="display:block; border-radius:20px;"></iframe>`;
    document.getElementById('code-modal').style.display='flex';
}

window.onload = updatePreview;
</script>
</body>
</html>
