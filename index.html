function buildInnerGame() {
    // ... (весь код до переменной cfg остается прежним)
    
    return `<!DOCTYPE html><html><head><meta charset="UTF-8">
    <style>
        body { margin:0; height:100vh; overflow:hidden; font-family:${cfg.ff}; background:#000; color:#fff; display:flex; flex-direction:column; border-radius:30px; position: relative; box-sizing: border-box; border: 6px solid ${cfg.neon}; box-shadow: inset 0 0 15px ${cfg.neon}, 0 0 15px ${cfg.neon}; }
        
        @keyframes gold-mist { 
            0% { filter: drop-shadow(0 0 10px gold) brightness(1); } 
            50% { filter: drop-shadow(0 0 25px #f9e076) brightness(1.1); } 
            100% { filter: drop-shadow(0 0 10px gold) brightness(1); } 
        }

        .bg { position:fixed; inset:0; background:url(${cfg.bg}) center/cover; opacity:0.5; z-index:-1; border-radius:24px; }
        #game { height:100%; display:flex; flex-direction:column; justify-content: space-between; padding:${cfg.pv}vmin ${cfg.ph}vmin; box-sizing:border-box; }
        .score-box { font-size:8vmin; color:#f9e076; font-weight:900; text-align:center; text-shadow: 0 0 15px rgba(249, 224, 118, 0.8); z-index:10; }
        #pile-box { flex:1; position:relative; display:flex; justify-content:center; align-items:center; min-height: 25vmin; }
        
        .pig-wrapper { position: relative; height: 35vmin; display: flex; align-items: center; justify-content: center; animation: gold-mist 4s infinite ease-in-out; }
        .pig { height: 100%; width:auto; z-index:6; object-fit: contain; position: relative; pointer-events: none; }
        
        /* Накопленные монетки внутри */
        .coins-container { position:absolute; width:24vmin; height:16vmin; z-index:4; overflow:hidden; pointer-events:none; top: 52%; left: 50%; transform: translate(-50%, -50%); border-radius: 40%; }
        .coin-element { position:absolute; width:5vmin; height:5vmin; background:url(${cfg.coin}) center/cover no-repeat; opacity: 0.8; }
        
        /* Полет: теперь монетки летят ПОВЕРХ свинки, но растворяются в центре */
        .falling-coin { position:absolute; top:-20vh; left:50%; width:7vmin; height:7vmin; background:url(${cfg.coin}) center/cover no-repeat; z-index:100; filter: drop-shadow(0 0 8px gold); transform: translateX(-50%); }
        
        @keyframes fallIntoSlot { 
            0% { top:-20vh; left:50%; opacity:1; transform: translateX(-50%) rotate(0deg) scale(1.2); } 
            70% { opacity:1; }
            100% { top: 40%; left:50%; transform: translateX(-50%) rotate(360deg) scale(0); opacity: 0; } 
        }

        .ui { display:flex; flex-direction:column; justify-content:flex-end; align-items: center; z-index:10; }
        .q-text { width:100%; font-size:${cfg.fz}vmin; text-align:center; margin-bottom:1vmin; font-weight:bold; min-height:1.5em; display:flex; align-items:center; justify-content:center; }
        .btn-grid { display:grid; grid-template-columns: 1fr 1fr; gap:${cfg.btnGap}vmin; width: ${cfg.btnW}%; }
        button { border:none; background:${cfg.btnCol}; color:#000; height:${cfg.btnH}vmin; border-radius:15px; cursor:pointer; font-weight:bold; font-size:3.2vmin; transition: 0.2s; padding: 0; }
        button:hover { transform: scale(1.02); filter: brightness(1.2); }
        .screen { position:absolute; inset:0; background:rgba(0,0,0,0.9); z-index:100; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:5vmin; border-radius:24px; }
        #final-shower { position: absolute; inset: 0; pointer-events: none; z-index: 20; display: none; }
        @keyframes endRain { 0% { top:-10vh; opacity:1; } 100% { top:110vh; opacity:0.3; } }
    </style></head><body>
        <div id="final-shower"></div><div class="bg"></div>
        <div id="game">
            <div id="start-screen" class="screen"><h1 style="font-size:8vmin; color:#f9e076;">${cfg.title}</h1><button onclick="startGame()" style="width:40vmin; height:10vmin;">${cfg.btnTxt}</button></div>
            <div class="score-box" id="total-score">0</div>
            <div id="pile-box">
                <div class="pig-wrapper">
                    <img id="pig-img" src="${cfg.pigs[0]}" class="pig">
                    <div class="coins-container" id="pile"></div>
                </div>
            </div>
            <div class="ui"><div class="q-text" id="q-label"></div><div id="btn-area" class="btn-grid"></div></div>
        </div>
    <script>
        let score = 0, currentLvl = 0, currentQ = 0, stake = 0;
        const cfg = ${JSON.stringify(cfg)};
        const labels = { ru: "СТАВКА:", en: "STAKE:", de: "EINSATZ:", ru: "СТАВКА:" };
        const snd = {
            coin: () => { const a = new Audio(cfg.sfxCoin); a.volume = cfg.vol || 0.5; a.play().catch(()=>{}); },
            final: () => { const a = new Audio(cfg.sfxFinal); a.loop = true; a.volume = cfg.vol || 0.5; a.play().catch(()=>{}); }
        };
        function startGame() { document.getElementById('start-screen').style.display='none'; nextStep(); }
        function nextStep() {
            if(currentLvl >= cfg.levels.length) { finishGame(); return; }
            if(cfg.levels[currentLvl].length === 0) { currentLvl++; nextStep(); return; }
            if(currentQ >= cfg.levels[currentLvl].length) { currentLvl++; currentQ = 0; nextStep(); return; }
            showStakes();
        }
        function showStakes() {
            document.getElementById('q-label').innerText = labels[cfg.lang] || labels.en;
            const area = document.getElementById('btn-area'); area.innerHTML = '';
            [10, 50, 100, 250].forEach(val => {
                const b = document.createElement('button'); b.innerText = val;
                b.onclick = () => { stake = val; showQuestion(); }; area.appendChild(b);
            });
        }
        function showQuestion() {
            const data = cfg.levels[currentLvl][currentQ];
            document.getElementById('q-label').innerText = data.q;
            const area = document.getElementById('btn-area'); area.innerHTML = '';
            [...data.a].sort(() => Math.random() - 0.5).forEach(txt => {
                const b = document.createElement('button'); b.innerText = txt;
                b.onclick = () => {
                    if(txt === data.a[0]) { 
                        score += stake; 
                        spawnCoins(Math.ceil(stake/10)); 
                        if(currentLvl < 5) document.getElementById('pig-img').src = cfg.pigs[currentLvl+1]; 
                    }
                    else { score = Math.max(0, score - stake); removeCoins(Math.ceil(stake/10)); }
                    document.getElementById('total-score').innerText = score;
                    currentQ++; setTimeout(nextStep, 1500);
                }; area.appendChild(b);
            });
        }
        function spawnCoins(num) { 
            for(let i=0; i<num; i++) { 
                setTimeout(() => { 
                    const c = document.createElement('div'); 
                    c.className = 'falling-coin'; 
                    c.style.animation = 'fallIntoSlot 0.6s ease-in forwards'; 
                    document.getElementById('game').appendChild(c); 
                    snd.coin(); 
                    setTimeout(() => { c.remove(); addToPile(); }, 550); 
                }, i * 100); 
            } 
        }
        function addToPile() { 
            const p = document.getElementById('pile'); 
            const c = document.createElement('div'); 
            c.className = 'coin-element'; 
            c.style.left = (Math.random() * 60 + 20) + '%'; 
            c.style.top = (Math.random() * 50 + 30) + '%'; 
            c.style.transform = 'rotate(' + (Math.random()*360) + 'deg)'; 
            p.appendChild(c); 
        }
        function removeCoins(num) { const p = document.getElementById('pile'); for(let i=0; i<num; i++) if(p.lastChild) p.lastChild.remove(); }
        function finishGame() { document.getElementById('pig-img').src = cfg.pigs[5]; document.getElementById('q-label').innerText = cfg.endTxt; document.getElementById('btn-area').innerHTML = '<button onclick="location.reload()" style="width: 100%; grid-column: 1 / 3;">RESTART</button>'; snd.final(); startRain(); }
        function startRain() { const f = document.getElementById('final-shower'); f.style.display = 'block'; setInterval(() => { const c = document.createElement('div'); c.style.position = 'absolute'; c.style.width = '7vmin'; c.style.height = '7vmin'; c.style.background = 'url('+cfg.coin+') center/cover'; c.style.left = Math.random() * 100 + '%'; c.style.top = '-10vh'; c.style.animation = 'endRain ' + (2.5 + Math.random() * 2) + 's linear forwards'; f.appendChild(c); setTimeout(() => c.remove(), 5000); }, 50); }
    <\/script></body></html>`;
}
