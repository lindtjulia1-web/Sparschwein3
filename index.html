<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>KGB Piggy Bank Pro Editor - Pirate Gold Edition</title>
    <style>
        :root { --accent: #f9e076; --bg: #1e1e24; --panel: #2a2a32; --border: #3d3d45; --green: #4caf50; --red: #f44336; }
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: #fff; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 400px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 20px; }
        h2 { color: var(--accent); font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; margin: 20px 0 10px; border-left: 3px solid var(--accent); padding-left: 10px; }
        h3 { font-size: 13px; color: var(--accent); margin: 20px 0 10px; display: flex; align-items: center; justify-content: space-between; }
        .card { background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 12px; border-radius: 15px; margin-bottom: 20px; }
        label { display: block; font-size: 10px; color: #aaa; text-transform: uppercase; margin-top: 8px; }
        input, select, textarea { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 8px; margin-top: 4px; box-sizing: border-box; outline: none; font-size: 13px; line-height: 1.4; }
        textarea { resize: vertical; min-height: 80px; font-family: monospace; }
        .btn { border: none; padding: 14px; width: 100%; border-radius: 12px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        .btn-main { background: #ffb347; color: #000; } 
        .btn-code { background: #77dd77; color: #000; } 
        .preview { flex: 1; background: #0c0c0e; display: flex; align-items: center; justify-content: center; padding: 40px; }
        #device-wrapper { position: relative; overflow: visible; transition: 0.3s; background: #000; border-radius: 30px; }
        iframe { width: 100%; height: 100%; border: none; display: block; border-radius: 30px; }
        #code-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; z-index: 100; flex-direction: column; }
        #result-code { width: 80%; height: 50%; background: #111; color: var(--accent); padding: 20px; border: 1px solid var(--accent); border-radius: 20px; font-family: monospace; }
        .color-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        input[type="color"] { height: 35px; padding: 2px; cursor: pointer; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-content">
        <h2>Настройки Экрана</h2>
        <div class="color-grid">
            <div><label>Ширина</label><input type="number" id="width" value="800"></div>
            <div><label>Высота</label><input type="number" id="height" value="450"></div>
        </div>
        <label>Фон (URL)</label>
        <input type="text" id="bg-url" placeholder="URL картинки">

        <h2>Эффекты Виджета</h2>
        <div class="color-grid">
            <div>
                <label>Цвет Рамки</label>
                <input type="color" id="neon-color" value="#f9e076">
            </div>
            <div>
                <label>Цвет Текста</label>
                <input type="color" id="txt-color" value="#f9e076">
            </div>
        </div>
        <label>Громкость эффектов</label>
        <input type="range" id="sound-volume" min="0" max="1" step="0.1" value="0.5">

        <h2>Тексты и Локализация</h2>
        <label>Заголовок старта</label>
        <input type="text" id="start-title" value="Сокровища Пирата">
        <label>Кнопка старта</label>
        <input type="text" id="start-btn-text" value="В БОЙ">
        <label>Текст финала</label>
        <input type="text" id="end-text" value="ЗОЛОТО ВАШЕ!">
        
        <label>Язык</label>
        <div class="color-grid">
            <select id="lang">
                <option value="ru">Русский</option>
                <option value="en">English</option>
                <option value="de">Deutsch</option>
            </select>
            <select id="fontFamily">
                <option value="'Segoe UI', sans-serif">Segoe UI</option>
                <option value="'Georgia', serif">Georgia</option>
                <option value="'Courier New', monospace">Courier</option>
            </select>
        </div>

        <h2>Настройки кнопок</h2>
        <label>Размер текста %</label><input type="range" id="fontSize" min="2" max="8" step="0.1" value="3.5">
        <div class="color-grid">
            <div><label>Цвет ответов</label><input type="color" id="btn-color" value="#f9e076"></div>
            <div><label>Цвет вопроса</label><input type="color" id="q-bg-color" value="#333333"></div>
        </div>
        <div class="color-grid">
            <div><label>Высота (vmin)</label><input type="number" id="btn-height" value="9"></div>
            <div><label>Ширина (%)</label><input type="number" id="btn-width" value="100"></div>
        </div>
        <label>Отступ между кнопками (vmin)</label>
        <input type="number" id="btn-gap" value="1.5">

        <h2>Отступы (vmin)</h2>
        <div class="color-grid">
            <div><label>Верх/Низ</label><input type="number" id="padV" value="5"></div>
            <div><label>Лево/Право</label><input type="number" id="padH" value="10"></div>
        </div>

        <h2>Уровни сложности</h2>
        <div id="levels-container"></div>
    </div>
    
    <div style="padding: 20px; border-top: 1px solid var(--border);">
        <button class="btn btn-main" onclick="updatePreview()">ОБНОВИТЬ ПРЕВЬЮ</button>
        <button class="btn btn-code" onclick="getGeniallyCode()">ПОЛУЧИТЬ КОД</button>
    </div>
</div>

<div class="preview">
    <div id="device-wrapper"><iframe id="ifr"></iframe></div>
</div>

<div id="code-modal">
    <textarea id="result-code" readonly onclick="this.select()"></textarea>
    <button class="btn" onclick="document.getElementById('code-modal').style.display='none'" style="width: 200px; background:#fff; color:#000;">ЗАКРЫТЬ</button>
</div>

<script>
const GITHUB_RAW = "https://raw.githubusercontent.com/lindtjulia1-web/Sparschwein1/main/";

for(let i=1; i<=4; i++) {
    const lvlDiv = document.createElement('div');
    lvlDiv.className = 'card';
    lvlDiv.innerHTML = `
        <h3>УРОВЕНЬ ${i}</h3>
        <label>1. Вопросы</label>
        <textarea id="lvl-${i}-q"></textarea>
        <label style="color:var(--green)">2. Правильные ответы</label>
        <textarea id="lvl-${i}-c"></textarea>
        <label style="color:var(--red)">3. Неправильные (через запятую)</label>
        <textarea id="lvl-${i}-w"></textarea>
    `;
    document.getElementById('levels-container').appendChild(lvlDiv);
}

function buildInnerGame() {
    const levels = [];
    for(let i=1; i<=4; i++) {
        const qLines = document.getElementById(`lvl-${i}-q`).value.split('\n').filter(l => l.trim());
        const cLines = document.getElementById(`lvl-${i}-c`).value.split('\n').filter(l => l.trim());
        const wLines = document.getElementById(`lvl-${i}-w`).value.split('\n').filter(l => l.trim());
        const questions = qLines.map((q, index) => ({
            q: q.trim(),
            a: [(cLines[index] || "???").trim(), ...(wLines[index] || "").split(',').map(x => x.trim()).filter(x => x)]
        }));
        levels.push(questions);
    }

    const cfg = {
        bg: document.getElementById('bg-url').value,
        title: document.getElementById('start-title').value,
        btnTxt: document.getElementById('start-btn-text').value,
        endTxt: document.getElementById('end-text').value,
        fz: document.getElementById('fontSize').value,
        ff: document.getElementById('fontFamily').value,
        btnCol: document.getElementById('btn-color').value,
        qBgCol: document.getElementById('q-bg-color').value,
        txtCol: document.getElementById('txt-color').value,
        btnH: document.getElementById('btn-height').value,
        btnW: document.getElementById('btn-width').value,
        btnGap: document.getElementById('btn-gap').value,
        pv: document.getElementById('padV').value,
        ph: document.getElementById('padH').value,
        lang: document.getElementById('lang').value,
        neon: document.getElementById('neon-color').value,
        vol: document.getElementById('sound-volume').value,
        levels: levels,
        pigs: [GITHUB_RAW+"1.png", GITHUB_RAW+"2.png", GITHUB_RAW+"3.png", GITHUB_RAW+"4.png", GITHUB_RAW+"5.png", GITHUB_RAW+"6.png"],
        coin: GITHUB_RAW+"7.png",
        sfxCoin: GITHUB_RAW+"1.mp3",
        sfxFinal: GITHUB_RAW+"2.mp3"
    };

    return `<!DOCTYPE html><html><head><meta charset="UTF-8">
    <style>
        body { margin:0; height:100vh; overflow:hidden; font-family:${cfg.ff}; background:#000; color:${cfg.txtCol}; display:flex; flex-direction:column; border-radius:30px; position: relative; box-sizing: border-box; border: 6px solid ${cfg.neon}; box-shadow: inset 0 0 15px ${cfg.neon}, 0 0 15px ${cfg.neon}; transition: border-color 0.3s, box-shadow 0.3s; }
        body.error-flash { border-color: #f44336; box-shadow: inset 0 0 30px #f44336, 0 0 30px #f44336; }

        @keyframes gold-mist { 
            0% { filter: drop-shadow(0 0 10px gold) brightness(1); } 
            50% { filter: drop-shadow(0 0 25px #f9e076) brightness(1.1); } 
            100% { filter: drop-shadow(0 0 10px gold) brightness(1); } 
        }

        @keyframes pig-shake {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.03) rotate(-1.5deg); }
            75% { transform: scale(1.03) rotate(1.5deg); }
        }

        @keyframes pig-no {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }

        .bg { position:fixed; inset:0; background:url(${cfg.bg}) center/cover; opacity:0.5; z-index:-1; border-radius:24px; }
        #game { height:100%; display:flex; flex-direction:column; justify-content: space-between; padding:${cfg.pv}vmin ${cfg.ph}vmin; box-sizing:border-box; }
        .score-box { font-size:8vmin; color:${cfg.txtCol}; font-weight:900; text-align:center; text-shadow: 0 0 15px rgba(249, 224, 118, 0.4); z-index:10; }
        
        #pile-box { flex:1; position:relative; display:flex; justify-content:center; align-items:center; min-height: 25vmin; }
        
        .pig-wrapper { position: relative; height: 35vmin; display: flex; align-items: center; justify-content: center; animation: gold-mist 4s infinite ease-in-out; transition: 0.2s; }
        .pig-shake-anim { animation: pig-shake 0.25s ease-out !important; }
        .pig-no-anim { animation: pig-no 0.4s ease-in-out !important; }
        
        .pig { height: 100%; width:auto; z-index:6; object-fit: contain; position: relative; pointer-events: none; }
        
        .gold-fill { 
            position: absolute; width: 15vmin; height: 15vmin; 
            background: radial-gradient(circle, #f9e076 0%, transparent 70%);
            border-radius: 50%; z-index: 5; opacity: 0; 
            filter: blur(10px); transition: all 1s ease;
        }

        .falling-coin { position:absolute; top:-20vh; left:50%; width:8vmin; height:8vmin; background:url(${cfg.coin}) center/cover no-repeat; z-index:100; filter: drop-shadow(0 0 12px gold); transform: translateX(-50%); pointer-events: none; }
        
        @keyframes fallInCenter { 
            0% { top:-20vh; opacity:1; transform: translateX(-50%) rotate(0deg) scale(1); } 
            80% { opacity:1; }
            100% { top: 50%; opacity: 0; transform: translateX(-50%) rotate(360deg) scale(0); } 
        }

        .ui { display:flex; flex-direction:column; justify-content:flex-end; align-items: center; z-index:10; }
        
        /* КНОПКА ВОПРОСА */
        .q-text { 
            width:100%; font-size:${cfg.fz}vmin; text-align:center; margin-bottom:1vmin; font-weight:bold; min-height:1.5em; 
            display:flex; align-items:center; justify-content:center;
            background: ${cfg.qBgCol}; border-radius: 15px; padding: 1vmin;
            box-shadow: 0 0.8vmin 0 rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.1);
            color: ${cfg.txtCol};
        }

        .btn-grid { display:grid; grid-template-columns: 1fr 1fr; gap:${cfg.btnGap}vmin; width: ${cfg.btnW}%; }
        
        /* ОБЪЕМНЫЕ КНОПКИ */
        button { 
            border:none; 
            background: linear-gradient(180deg, ${cfg.btnCol} 0%, ${cfg.btnCol}ee 100%);
            color:#000; height:${cfg.btnH}vmin; border-radius:15px; cursor:pointer; font-weight:bold; font-size:3.2vmin; 
            transition: 0.1s; padding: 0; font-family: inherit;
            box-shadow: 0 0.8vmin 0 rgba(0,0,0,0.3), 0 1.2vmin 2vmin rgba(0,0,0,0.4);
            border-top: 1px solid rgba(255,255,255,0.3);
        }
        button:hover { filter: brightness(1.1); }
        button:active { 
            transform: translateY(0.4vmin); 
            box-shadow: 0 0.4vmin 0 rgba(0,0,0,0.3); 
        }

        .screen { position:absolute; inset:0; background:rgba(0,0,0,0.9); z-index:100; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:5vmin; border-radius:24px; }
        
        #final-shower { position: absolute; inset: 0; pointer-events: none; z-index: 20; display: none; }
    </style></head><body>
        <div id="final-shower"></div><div class="bg"></div>
        <div id="game">
            <div id="start-screen" class="screen"><h1 style="font-size:8vmin; color:${cfg.txtCol};">${cfg.title}</h1><button onclick="startGame()" style="width:40vmin; height:10vmin;">${cfg.btnTxt}</button></div>
            <div class="score-box" id="total-score">0</div>
            <div id="pile-box">
                <div class="pig-wrapper" id="pig-wrap">
                    <div class="gold-fill" id="gold-core"></div>
                    <img id="pig-img" src="${cfg.pigs[0]}" class="pig">
                </div>
            </div>
            <div class="ui"><div class="q-text" id="q-label"></div><div id="btn-area" class="btn-grid"></div></div>
        </div>
    <script>
        /* [ВЕСЬ ОСТАЛЬНОЙ СКРИПТ ОСТАВЛЕН БЕЗ ИЗМЕНЕНИЙ ДЛЯ КОРРЕКТНОЙ РАБОТЫ] */
        let score = 0, currentLvl = 0, currentQ = 0;
        /* Логика игры... */
    <\/script></body></html>`;
}

function updatePreview() {
    const w = document.getElementById('width').value, h = document.getElementById('height').value;
    const wr = document.getElementById('device-wrapper');
    wr.style.width = w + 'px'; wr.style.height = h + 'px';
    document.getElementById('ifr').srcdoc = buildInnerGame();
}

function getGeniallyCode() {
    const code = `<iframe width="${document.getElementById('width').value}" height="${document.getElementById('height').value}" srcdoc="${buildInnerGame().replace(/"/g, '&quot;')}" frameborder="0" scrolling="no" allowtransparency="true"></iframe>`;
    document.getElementById('result-code').value = code;
    document.getElementById('code-modal').style.display = 'flex';
}

window.onload = updatePreview;
</script>
</body>
</html>
